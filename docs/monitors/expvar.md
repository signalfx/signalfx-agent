<!--- GENERATED BY gomplate from scripts/docs/monitor-page.md.tmpl --->

# expvar

This monitor exports metrics derived from [expvar](https://golang.org/pkg/expvar/)
variables in JSON objects retrieved from a HTTP endpoint.

The monitor uses configured JSON paths to get metric and dimension values from the fetched JSON objects.
[Memstats metrics](https://github.com/signalfx/integrations/blob/master/expvar/docs/expvar_metrics.md)
are created by default. They do not require any configuration. They are derived from variable
[memstats](https://golang.org/pkg/runtime/) that is exposed by default.

Below is a sample YAML configuration showing the minimal configuration of the expvar monitor. Only
memstats metrics will be exported for this configuration. The `extraDimensions` field is not required but recommended.
```
monitors:
- type: expvar
  host: 172.17.0.3
  path: /debug/vars
  port: 8000
```
It is recommended to add the `metric_source` extra dimension as show below in order to facilitate filtering in
SignalFx.
```
monitors:
- type: expvar
  host: 172.17.0.3
  path: /debug/vars
  port: 8000
  extraDimensions:
    metric_source: expvar
```

Below is a sample YAML configuration showing the configuration of custom metrics `xyz` and `h.i`. The `name`s
of metrics and dimensionals are optional. The `JSONPath` is used for `name` instead if not provided.
```
monitors:
- type: expvar
  host: 172.12.0.6
  path: /debug/vars
  port: 8123
    metrics:
      - name: xyz
        JSONPath: a.b.c.d
        type: counter
        dimensions:
          - name: rst
            JSONPath: a.b
      - JSONPath: h.i
        type: gauge
      - JSONPath: j
        type: gauge
        dimensions:
          - name: kl
            value: mno
  extraDimensions:
    metric_source: expvar
```

Below is an example JSON object that the above configuration may apply to.
```
{
 "a": {
   "b": {
     "c": [
       {
         "d": 4
       },
       {
         "d": 9
       },
     ]
   }
 },
 "h": [
   {
     "i": 1.2
   }
 ],
 "j" : 0.8
}
```

Two data points will be created for the metric `a.b.c.d`. The first data point will have the value 4 and
dimensions `a.b = c`, `a.b.c = 0` and `metric_source = expvar`. The second data point will have the value 9
and dimensions `a.b = c`, `a.b.c = 1` and `metric_source = expvar`. The monitor creates dimensions such as
`a.b.c` automatically to store array indexes.

For metric `h.i`, a data point of value 1.2, dimensions `h = 0` and `metric_source = expvar` will be created.

For metric `j`, a data point of value 0.8, dimensions `kl = mno` and `metric_source = expvar` will be created.
Note that the value for dimension `kl` was provided.

The path of a dimension must follow the path of its metric and be shorter.


Monitor Type: `expvar`

[Monitor Source Code](https://github.com/signalfx/signalfx-agent/tree/master/internal/monitors/expvar)

**Accepts Endpoints**: **Yes**

**Multiple Instances Allowed**: Yes

## Configuration

| Config option | Required | Type | Description |
| --- | --- | --- | --- |
| `host` | **yes** | `string` | Host of the expvar endpoint |
| `port` | **yes** | `integer` | Port of the expvar endpoint |
| `useHTTPS` | no | `bool` | If true, the agent will connect to the host using HTTPS instead of plain HTTP. (**default:** `false`) |
| `skipVerify` | no | `bool` | If useHTTPS is true and this option is also true, the host's TLS cert will not be verified. (**default:** `false`) |
| `path` | no | `string` | Path to the expvar endpoint, usually `/debug/vars` (the default). (**default:** `/debug/vars`) |
| `enhancedMetrics` | no | `bool` | Excludes metrics memstats.alloc, memstats.by_size.size, memstats.by_size.mallocs and memstats.by_size.frees if false (**default:** `false`) |
| `metrics` | no | `list of objects (see below)` | Metrics configurations |


The **nested** `metrics` config object has the following fields:

| Config option | Required | Type | Description |
| --- | --- | --- | --- |
| `name` | no | `string` | Metric name |
| `JSONPath` | **yes** | `string` | JSON path of the metric value |
| `type` | **yes** | `string` | SignalFx metric type. Possible values are "gauge" or "counter" |
| `dimensions` | no | `list of objects (see below)` | Metric dimensions |


The **nested** `dimensions` config object has the following fields:

| Config option | Required | Type | Description |
| --- | --- | --- | --- |
| `name` | no | `string` | Dimension name |
| `JSONPath` | no | `string` | JSON path of the dimension value |
| `value` | no | `string` | Dimension value |




## Metrics

The following table lists the metrics available for this monitor. Metrics that are not marked as Custom are standard metrics and are monitored by default.

| Name | Type | Custom | Description |
| ---  | ---  | ---    | ---         |
| `memstats.alloc` | gauge | X | Bytes of allocated heap objects. Same as memstats.heap_alloc |
| `memstats.heap_alloc` | gauge |  | Bytes of allocated heap objects |
| `memstats.heap_sys` | gauge | X | Bytes of heap memory obtained from the OS |
| `memstats.heap_idle` | gauge |  | Bytes in idle (unused) spans |
| `memstats.heap_inuse` | gauge |  | Bytes in in-use spans |
| `memstats.heap_released` | gauge |  | Bytes of physical memory returned to the OS |
| `memstats.heap_objects` | gauge |  | Number of allocated heap objects |
| `memstats.stack_inuse` | gauge |  | Bytes in stack spans |
| `memstats.stack_sys` | gauge |  | Bytes of stack memory obtained from the OS |
| `memstats.m_span_inuse` | gauge |  | Bytes of allocated mspan structures |
| `memstats.m_span_sys` | gauge |  | Bytes of memory obtained from the OS for mspan |
| `memstats.m_cache_inuse` | gauge |  | Bytes of allocated mcache structures |
| `memstats.m_cache_sys` | gauge |  | Bytes of memory obtained from the OS for mcache structures |
| `memstats.buck_hash_sys` | gauge |  | Bytes of memory in profiling bucket hash tables |
| `memstats.gc_sys` | gauge |  | Bytes of memory in garbage collection metadata |
| `memstats.other_sys` | gauge |  | Bytes of memory in miscellaneous off-heap runtime allocations |
| `memstats.sys` | gauge |  | total bytes of memory obtained from the OS |
| `memstats.next_gc` | gauge |  | Target heap size of the next GC cycle |
| `memstats.last_gc` | gauge |  | The time the last garbage collection finished, as nanoseconds since 1970 (the UNIX epoch) |
| `memstats.gccpu_fraction` | gauge |  | The fraction of this program's available CPU time used by the GC since the program started |
| `memstats.enable_gc` | gauge |  | Boolean that indicates that GC is enabled. It is always true, even if GOGC=off |
| `memstats.debug_gc` | gauge | X | memstats.debug_gc is currently unused |
| `memstats.most_recent_gc_pause_ns` | gauge |  | Most recent GC stop-the-world pause time in nanoseconds |
| `memstats.most_recent_gc_pause_end` | gauge |  | Most recent GC pause end time, as nanoseconds since 1970 (the UNIX epoch) |
| `memstats.total_alloc` | counter |  | Cumulative bytes allocated for heap objects |
| `memstats.lookups` | counter |  | Number of pointer lookups performed by the runtime |
| `memstats.mallocs` | counter |  | Cumulative count of heap objects allocated |
| `memstats.frees` | counter |  | Cumulative count of heap objects freed |
| `memstats.pause_total_ns` | counter |  | Cumulative nanoseconds in GC stop-the-world pauses since the program started |
| `memstats.num_gc` | counter |  | Number of completed GC cycles |
| `memstats.num_forced_gc` | counter |  | Number of GC cycles that were forced by the application calling the GC function |
| `memstats.by_size.size` | counter | X | The maximum byte size of a class identified by dimension class. It is the class interval upper limit. The values of dimension class are numbers between 0 and 60 inclusive. Consecutive classes are of consecutive dimension class values. The lower limit of a class is the upper limit of the consecutive class below. Metrics memstats.by_size.size, memstats.by_size.mallocs and memstats.by_size.frees of the same class are related |
| `memstats.by_size.mallocs` | counter | X | Cumulative count of heap objects allocated in a class. The class is identified by dimension class and it is as described for metric memstats.by_size.size |
| `memstats.by_size.frees` | counter | X | Cumulative count of heap objects freed in a class. The class is identified by dimension class and it is as described for metric memstats.by_size.size |


To specify custom metrics you want to monitor, add a `metricsToInclude` filter
to the agent configuration, as shown in the code snippet below. The snippet
lists all available custom metrics. You can copy and paste the snippet into
your configuration file, then delete any custom metrics that you do not want
sent.

Note that some of the custom metrics require you to set a flag as well as add
them to the list. Check the monitor configuration file to see if a flag is
required for gathering additional metrics.

```yaml

metricsToInclude:
  - metricNames:
    - memstats.alloc
    - memstats.heap_sys
    - memstats.debug_gc
    - memstats.by_size.size
    - memstats.by_size.mallocs
    - memstats.by_size.frees
    monitorType: expvar
```




