<!--- GENERATED BY gomplate from scripts/docs/top-config.md.tmpl --->
# Agent Configuration

The agent is configured primarily by a YAML document conventionally located at
`/etc/signalfx/agent.yaml`.  The location of the config file can be specified
by the `-config` flag to the agent binary (`signalfx-agent`).

## Config Schema

  
| Config option | Required | Type | Description |
| --- | --- | --- | --- |
| `signalFxAccessToken` | no | string | The access token for the org that should receive the metrics emitted by the agent. |
| `ingestUrl` | no | string | The URL of SignalFx ingest server.  Should be overridden if using the SignalFx Gateway.  If you want to send trace spans to a different location, set the `traceEndpointUrl` option. (**default:** `"https://ingest.signalfx.com"`) |
| `traceEndpointUrl` | no | string | The full URL (including path) to the trace ingest server.  If this is not set, all trace spans will be sent to the `ingestUrl` configured above. |
| `apiUrl` | no | string | The SignalFx API base URL (**default:** `"https://api.signalfx.com"`) |
| `hostname` | no | string | The hostname that will be reported as the `host` dimension. If blank, this will be auto-determined by the agent based on a reverse lookup of the machine's IP address. |
| `useFullyQualifiedHost` | no | bool | If true (the default), and the `hostname` option is not set, the hostname will be determined by doing a reverse DNS query on the IP address that is returned by querying for the bare hostname.  This is useful in cases where the hostname reported by the kernel is a short name. (**default**: `true`) |
| `disableHostDimensions` | no | bool | Our standard agent model is to collect metrics for services running on the same host as the agent.  Therefore, host-specific dimensions (e.g. `host`, `AWSUniqueId`, etc) are automatically added to every datapoint that is emitted from the agent by default.  Set this to true if you are using the agent primarily to monitor things on other hosts.  You can set this option at the monitor level as well. (**default:** `false`) |
| `intervalSeconds` | no | integer | How often to send metrics to SignalFx.  Monitors can override this individually. (**default:** `10`) |
| `globalDimensions` | no | map of string | Dimensions (key:value pairs) that will be added to every datapoint emitted by the agent. To specify that all metrics should be high-resolution, add the dimension `sf_hires: 1` |
| `sendMachineID` | no | bool | Whether to send the machine-id dimension on all host-specific datapoints generated by the agent.  This dimension is derived from the Linux machine-id value. (**default:** `false`) |
| `observers` | no | [list of object (see below)](#observers) | A list of observers to use (see observer config) |
| `monitors` | no | [list of object (see below)](#monitors) | A list of monitors to use (see monitor config) |
| `writer` | no | [object (see below)](#writer) | Configuration of the datapoint/event writer |
| `logging` | no | [object (see below)](#logging) | Log configuration |
| `collectd` | no | [object (see below)](#collectd) | Configuration of the managed collectd subprocess |
| `metricsToInclude` | no | [list of object (see below)](#metricstoinclude) | A list of metric filters that will whitelist/include metrics.  These filters take priority over the filters specified in `metricsToExclude`. |
| `metricsToExclude` | no | [list of object (see below)](#metricstoexclude) | A list of metric filters |
| `propertiesToExclude` | no | [list of object (see below)](#propertiestoexclude) | A list of properties filters |
| `pythonEnabled` | no | bool | (**NOT FUNCTIONAL**) Whether to enable the Python sub-agent ("neopy") that can directly use DataDog and Collectd Python plugins.  This is not the same as Collectd's Python plugin, which is always enabled. (**default:** `false`) |
| `internalStatusHost` | no | string | The host on which the internal status server will listen.  The internal status HTTP server serves internal metrics and diagnostic information about the agent and can be scraped by the `internal-metrics` monitor. Can be set to `0.0.0.0` if you want to monitor the agent from another host.  If you set this to blank/null, the internal status server will not be started. (**default:** `"localhost"`) |
| `internalStatusPort` | no | integer | The port on which the internal status server will listen.  See `internalMetricsHost`. (**default:** `8095`) |
| `profiling` | no | bool | Enables Go pprof endpoint on port 6060 that serves profiling data for development (**default:** `false`) |
| `bundleDir` | no | string | Path to the directory holding the agent dependencies.  This will normally be derived automatically. Overrides the envvar SIGNALFX_BUNDLE_DIR if set. |
| `scratch` | no | any | This exists purely to give the user a place to put common yaml values to reference in other parts of the config file. |
| `configSources` | no | [object (see below)](#configsources) | Configuration of remote config stores |
| `procPath` | no | string | Path to the host's `/proc` filesystem. This is useful for containerized environments. (**default:** `"/proc"`) |
| `etcPath` | no | string | Path to the host's `/etc` directory. This is useful for containerized environments. (**default:** `"/etc"`) |
| `varPath` | no | string | Path to the host's `/var` directory. This is useful for containerized environments. (**default:** `"/var"`) |
| `runPath` | no | string | Path to the host's `/run` directory. This is useful for containerized environments. (**default:** `"/run"`) |
| `sysPath` | no | string | Path to the host's `/sys` directory. This is useful for containerized environments. (**default:** `"/sys"`) |


## observers
The **nested** `observers` config object has the following fields:

The following are generic options that apply to all observers.  Each observer type has its own set of additional configuration options, detailed in [Observer Config](./observer-config.md).

| Config option | Required | Type | Description |
| --- | --- | --- | --- |
| `type` | no | string | The type of the observer |



## monitors
The **nested** `monitors` config object has the following fields:

The following are generic options that apply to all monitors.  Each monitor type has its own set of additional configuration options, detailed in [Monitor Config](./monitor-config.md).

| Config option | Required | Type | Description |
| --- | --- | --- | --- |
| `type` | no | string | The type of the monitor |
| `discoveryRule` | no | string | The rule used to match up this configuration with a discovered endpoint. If blank, the configuration will be run immediately when the agent is started.  If multiple endpoints match this rule, multiple instances of the monitor type will be created with the same configuration (except different host/port). |
| `extraDimensions` | no | map of string | A set of extra dimensions (key:value pairs) to include on datapoints emitted by the monitor(s) created from this configuration. To specify metrics from this monitor should be high-resolution, add the dimension `sf_hires: 1` |
| `intervalSeconds` | no | integer | The interval (in seconds) at which to emit datapoints from the monitor(s) created by this configuration.  If not set (or set to 0), the global agent intervalSeconds config option will be used instead. (**default:** `0`) |
| `solo` | no | bool | If one or more configurations have this set to true, only those configurations will be considered -- useful for testing (**default:** `false`) |
| `metricsToExclude` | no | [list of object (see below)](#metricstoexclude) | A list of metric filters |
| `disableHostDimensions` | no | bool | Some monitors pull metrics from services not running on the same host and should not get the host-specific dimensions set on them (e.g. `host`, `AWSUniqueId`, etc).  Setting this to `true` causes those dimensions to be omitted.  You can disable this globally with the `disableHostDimensions` option on the top level of the config. (**default:** `false`) |
| `disableEndpointDimensions` | no | bool | This can be set to true if you don't want to include the dimensions that are specific to the endpoint that was discovered by an observer.  This is useful when you have an endpoint whose identity is not particularly important since it acts largely as a proxy or adapter for other metrics. (**default:** `false`) |


## metricsToExclude
The **nested** `metricsToExclude` config object has the following fields:

For more information on filtering see [Datapoint Filtering](./filtering.md).


| Config option | Required | Type | Description |
| --- | --- | --- | --- |
| `dimensions` | no | map of string | A map of dimension key/values to match against.  All key/values must match a datapoint for it to be matched. |
| `metricNames` | no | list of string | A list of metric names to match against, OR'd together |
| `metricName` | no | string | A single metric name to match against |
| `monitorType` | no | string | (**Only applicable for the top level filters**) Limits this scope of the filter to datapoints from a specific monitor. If specified, any datapoints not from this monitor type will never match against this filter. |
| `negated` | no | bool | Negates the result of the match so that it matches all datapoints that do NOT match the metric name and dimension values given. This does not negate monitorType, if given. (**default:** `false`) |




## writer
The **nested** `writer` config object has the following fields:



| Config option | Required | Type | Description |
| --- | --- | --- | --- |
| `datapointMaxBatchSize` | no | integer | The maximum number of datapoints to include in a batch before sending the batch to the ingest server.  Smaller batch sizes than this will be sent if datapoints originate in smaller chunks. (**default:** `1000`) |
| `traceSpanMaxBatchSize` | no | integer | The analogue of `datapointMaxBatchSize` for trace spans. (**default:** `1000`) |
| `datapointMaxRequests` | no | integer | Deprecated: use `maxRequests` instead. (**default:** `0`) |
| `maxRequests` | no | integer | The maximum number of concurrent requests to make to a single ingest server with datapoints/events/trace spans.  This number multipled by `datapointMaxBatchSize` is more or less the maximum number of datapoints that can be "in-flight" at any given time.  Same thing for the `traceSpanMaxBatchSize` option and trace spans. (**default:** `10`) |
| `eventSendIntervalSeconds` | no | integer | The agent does not send events immediately upon a monitor generating them, but buffers them and sends them in batches.  The lower this number, the less delay for events to appear in SignalFx. (**default:** `1`) |
| `propertiesMaxRequests` | no | unsigned integer | The analogue of `maxRequests` for dimension property requests. (**default:** `10`) |
| `propertiesHistorySize` | no | unsigned integer | Properties that are synced to SignalFx are cached to prevent duplicate requests from being sent, causing unnecessary load on our backend. (**default:** `1000`) |
| `logDatapoints` | no | bool | If the log level is set to `debug` and this is true, all datapoints generated by the agent will be logged. (**default:** `false`) |
| `logEvents` | no | bool | The analogue of `logDatapoints` for events. (**default:** `false`) |
| `logTraceSpans` | no | bool | The analogue of `logDatapoints` for trace spans. (**default:** `false`) |
| `logDroppedDatapoints` | no | bool | If true, and the log level is `debug`, filtered out datapoints will be logged. (**default:** `false`) |
| `sendTraceHostCorrelationMetrics` | no | bool | Whether to send host correlation metrics to correlation traced services with the underlying host (**default:** `false`) |
| `staleServiceTimeout` | no | int64 | How long to wait after a trace span's service name is last seen to continue sending the correlation datapoints for that service.  This should be a duration string that is accepted by https://golang.org/pkg/time/#ParseDuration.  This option is irrelvant if `sendTraceHostCorrelationMetrics` is false. (**default:** `"5m"`) |
| `traceHostCorrelationMetricsInterval` | no | int64 | How frequently to send host correlation metrics that are generated from the service name seen in trace spans sent through or by the agent.  This should be a duration string that is accepted by https://golang.org/pkg/time/#ParseDuration.  This option is irrelvant if `sendTraceHostCorrelationMetrics` is false. (**default:** `"1m"`) |
| `maxTraceSpansInFlight` | no | unsigned integer | How many trace spans are allowed to be in the process of sending.  While this number is exceeded, existing pending spans will be randomly dropped if possible to accommodate new spans generated to avoid memory exhaustion.  If you see log messages about "Aborting pending trace requests..." or "Dropping new trace spans..." it means that the downstream target for traces is not able to accept them fast enough. Usually if the downstream is offline you will get connection refused errors and most likely spans will not build up in the agent (there is no retry mechanism). In the case of slow downstreams, you might be able to increase `maxRequests` to increase the concurrent stream of spans downstream (if the target can make efficient use of additional connections) or, less likely, increase `traceSpanMaxBatchSize` if your batches are maxing out (turn on debug logging to see the batch sizes being sent) and being split up too much. If neither of those options helps, your downstream is likely too slow to handle the volume of trace spans and should be upgraded to more powerful hardware/networking. (**default:** `100000`) |



## logging
The **nested** `logging` config object has the following fields:



| Config option | Required | Type | Description |
| --- | --- | --- | --- |
| `level` | no | string | Valid levels include `debug`, `info`, `warn`, `error`.  Note that `debug` logging may leak sensitive configuration (e.g. passwords) to the agent output. (**default:** `"info"`) |



## collectd
The **nested** `collectd` config object has the following fields:



| Config option | Required | Type | Description |
| --- | --- | --- | --- |
| `disableCollectd` | no | bool | If you won't be using any collectd monitors, this can be set to true to prevent collectd from pre-initializing (**default:** `false`) |
| `timeout` | no | integer | How many read intervals before abandoning a metric. Doesn't affect much in normal usage. See [Timeout](https://collectd.org/documentation/manpages/collectd.conf.5.shtml#timeout_iterations). (**default:** `40`) |
| `readThreads` | no | integer | Number of threads dedicated to executing read callbacks. See [ReadThreads](https://collectd.org/documentation/manpages/collectd.conf.5.shtml#readthreads_num) (**default:** `5`) |
| `writeThreads` | no | integer | Number of threads dedicated to writing value lists to write callbacks. This should be much less than readThreads because writing is batched in the write_http plugin that writes back to the agent. See [WriteThreads](https://collectd.org/documentation/manpages/collectd.conf.5.shtml#writethreads_num). (**default:** `2`) |
| `writeQueueLimitHigh` | no | integer | The maximum numbers of values in the queue to be written back to the agent from collectd.  Since the values are written to a local socket that the agent exposes, there should be almost no queuing and the default should be more than sufficient. See [WriteQueueLimitHigh](https://collectd.org/documentation/manpages/collectd.conf.5.shtml#writequeuelimithigh_highnum) (**default:** `500000`) |
| `writeQueueLimitLow` | no | integer | The lowest number of values in the collectd queue before which metrics begin being randomly dropped.  See [WriteQueueLimitLow](https://collectd.org/documentation/manpages/collectd.conf.5.shtml#writequeuelimitlow_lownum) (**default:** `400000`) |
| `logLevel` | no | string | Collectd's log level -- info, notice, warning, or err (**default:** `"notice"`) |
| `intervalSeconds` | no | integer | A default read interval for collectd plugins.  If zero or undefined, will default to the global agent interval.  Some collectd python monitors do not support overridding the interval at the monitor level, but this setting will apply to them. (**default:** `0`) |
| `writeServerIPAddr` | no | string | The local IP address of the server that the agent exposes to which collectd will send metrics.  This defaults to an arbitrary address in the localhost subnet, but can be overridden if needed. (**default:** `"127.9.8.7"`) |
| `writeServerPort` | no | integer | The port of the agent's collectd metric sink server.  If set to zero (the default) it will allow the OS to assign it a free port. (**default:** `0`) |
| `configDir` | no | string | This is where the agent will write the collectd config files that it manages.  If you have secrets in those files, consider setting this to a path on a tmpfs mount.  The files in this directory should be considered transient -- there is no value in editing them by hand.  If you want to add your own collectd config, see the collectd/custom monitor. (**default:** `"/var/run/signalfx-agent/collectd"`) |



## metricsToInclude
The **nested** `metricsToInclude` config object has the following fields:



| Config option | Required | Type | Description |
| --- | --- | --- | --- |
| `dimensions` | no | map of string | A map of dimension key/values to match against.  All key/values must match a datapoint for it to be matched. |
| `metricNames` | no | list of string | A list of metric names to match against, OR'd together |
| `metricName` | no | string | A single metric name to match against |
| `monitorType` | no | string | (**Only applicable for the top level filters**) Limits this scope of the filter to datapoints from a specific monitor. If specified, any datapoints not from this monitor type will never match against this filter. |
| `negated` | no | bool | Negates the result of the match so that it matches all datapoints that do NOT match the metric name and dimension values given. This does not negate monitorType, if given. (**default:** `false`) |



## metricsToExclude
The **nested** `metricsToExclude` config object has the following fields:

For more information on filtering see [Datapoint Filtering](./filtering.md).


| Config option | Required | Type | Description |
| --- | --- | --- | --- |
| `dimensions` | no | map of string | A map of dimension key/values to match against.  All key/values must match a datapoint for it to be matched. |
| `metricNames` | no | list of string | A list of metric names to match against, OR'd together |
| `metricName` | no | string | A single metric name to match against |
| `monitorType` | no | string | (**Only applicable for the top level filters**) Limits this scope of the filter to datapoints from a specific monitor. If specified, any datapoints not from this monitor type will never match against this filter. |
| `negated` | no | bool | Negates the result of the match so that it matches all datapoints that do NOT match the metric name and dimension values given. This does not negate monitorType, if given. (**default:** `false`) |



## propertiesToExclude
The **nested** `propertiesToExclude` config object has the following fields:



| Config option | Required | Type | Description |
| --- | --- | --- | --- |
| `propertyName` | no | string | A single property name to match (**default:** `"*"`) |
| `propertyValue` | no | string | A property value to match (**default:** `"*"`) |
| `dimensionName` | no | string | A dimension name to match (**default:** `"*"`) |
| `dimensionValue` | no | string | A dimension value to match (**default:** `"*"`) |



## configSources
The **nested** `configSources` config object has the following fields:

For more information about how to use config sources, see [Remote Config](./remote-config.md).

| Config option | Required | Type | Description |
| --- | --- | --- | --- |
| `watch` | no | bool | Whether to watch config sources for changes.  If this is `true` and any of the config changes (either the main agent.yaml, or remote config values), the agent will dynamically reconfigure itself with minimal disruption.  This is generally better than restarting the agent on config changes since that can result in larger gaps in metric data.  The main disadvantage of watching is slightly greater network and compute resource usage. This option itself ironically enough is not subject to watching and changing it to false after the agent was started with it true will require an agent restart. (**default:** `true`) |
| `file` | no | [object (see below)](#file) | Configuration for other file sources |
| `zookeeper` | no | [object (see below)](#zookeeper) | Configuration for a Zookeeper remote config source |
| `etcd2` | no | [object (see below)](#etcd2) | Configuration for an Etcd 2 remote config source |
| `consul` | no | [object (see below)](#consul) | Configuration for a Consul remote config source |
| `vault` | no | [object (see below)](#vault) | Configuration for a Hashicorp Vault remote config source |


## file
The **nested** `file` config object has the following fields:



| Config option | Required | Type | Description |
| --- | --- | --- | --- |
| `pollRateSeconds` | no | integer | How often to poll files (in seconds) to test for changes.  There are so many edge cases that break inotify that it is more robust to simply poll files than rely on that. This option is not subject to watching and changes to it will require an agent restart. (**default:** `5`) |



## zookeeper
The **nested** `zookeeper` config object has the following fields:



| Config option | Required | Type | Description |
| --- | --- | --- | --- |
| `endpoints` | no | list of string | A list of Zookeeper servers to use for the client |
| `timeoutSeconds` | no | unsigned integer | Client timeout (**default:** `10`) |



## etcd2
The **nested** `etcd2` config object has the following fields:



| Config option | Required | Type | Description |
| --- | --- | --- | --- |
| `endpoints` | no | list of string | A list of Etcd2 servers to use |
| `username` | no | string | An optional username to use when connecting |
| `password` | no | string | An optional password to use when connecting |



## consul
The **nested** `consul` config object has the following fields:



| Config option | Required | Type | Description |
| --- | --- | --- | --- |
| `endpoint` | no | string | A Consul server URL |
| `username` | no | string | An optional username to use when connecting |
| `password` | no | string | An optional password to use when connecting |
| `token` | no | string | An authentication token, if needed |
| `datacenter` | no | string | The Consul datacenter to use |



## vault
The **nested** `vault` config object has the following fields:



| Config option | Required | Type | Description |
| --- | --- | --- | --- |
| `vaultAddr` | no | string | The Vault Address.  Can also be provided by the standard Vault envvar `VAULT_ADDR`.  This option takes priority over the envvar if provided. |
| `vaultToken` | no | string | The Vault token, can also be provided by it the standard Vault envvar `VAULT_TOKEN`.  This option takes priority over the envvar if provided. |
| `kvV2PollInterval` | no | int64 | The polling interval for checking KV V2 secrets for a new version.  This can be any string value that can be parsed by https://golang.org/pkg/time/#ParseDuration. (**default:** `"60s"`) |





## Example YAML

Here is an autogenerated example of a YAML config file, with default values
where applicable:


```yaml
  signalFxAccessToken: 
  ingestUrl: "https://ingest.signalfx.com"
  traceEndpointUrl: 
  apiUrl: "https://api.signalfx.com"
  hostname: 
  useFullyQualifiedHost: 
  disableHostDimensions: false
  intervalSeconds: 10
  globalDimensions: 
  sendMachineID: false
  observers: []
  monitors: []
  writer: 
    datapointMaxBatchSize: 1000
    traceSpanMaxBatchSize: 1000
    datapointMaxRequests: 0
    maxRequests: 10
    eventSendIntervalSeconds: 1
    propertiesMaxRequests: 10
    propertiesHistorySize: 1000
    logDatapoints: false
    logEvents: false
    logTraceSpans: false
    logDroppedDatapoints: false
    sendTraceHostCorrelationMetrics: false
    staleServiceTimeout: "5m"
    traceHostCorrelationMetricsInterval: "1m"
    maxTraceSpansInFlight: 100000
  logging: 
    level: "info"
  collectd: 
    disableCollectd: false
    timeout: 40
    readThreads: 5
    writeThreads: 2
    writeQueueLimitHigh: 500000
    writeQueueLimitLow: 400000
    logLevel: "notice"
    intervalSeconds: 0
    writeServerIPAddr: "127.9.8.7"
    writeServerPort: 0
    configDir: "/var/run/signalfx-agent/collectd"
  metricsToInclude: []
  metricsToExclude: []
  propertiesToExclude: []
  pythonEnabled: false
  internalStatusHost: "localhost"
  internalStatusPort: 8095
  profiling: false
  bundleDir: 
  scratch: 
  configSources: 
    watch: true
    file: 
      pollRateSeconds: 5
    zookeeper: 
      endpoints: []
      timeoutSeconds: 10
    etcd2: 
      endpoints: []
      username: 
      password: 
    consul: 
      endpoint: 
      username: 
      password: 
      token: 
      datacenter: 
    vault: 
      vaultAddr: 
      vaultToken: 
      kvV2PollInterval: "60s"
  procPath: "/proc"
  etcPath: "/etc"
  varPath: "/var"
  runPath: "/run"
  sysPath: "/sys"

```
